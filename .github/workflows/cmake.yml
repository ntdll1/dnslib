name: Build Windows Static Libraries

on: [push, pull_request]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2

    - name: Configure CMake
      run: |
        cmake src -A Win32 -D CMAKE_CXX_FLAGS_RELEASE=/MT -D CMAKE_CONFIGURATION_TYPES="Debug;Release" -B build-Win32
        cmake src -A x64 -D CMAKE_CXX_FLAGS_RELEASE=/MT -D CMAKE_CONFIGURATION_TYPES="Debug;Release" -B build-x64

    - name: Build
      run: |
        cmake --build build-Win32 --target dnslib --config Debug
        cmake --build build-Win32 --target dnslib --config Release
        cmake --build build-x64 --target dnslib --config Debug
        cmake --build build-x64 --target dnslib --config Release
        cmake -E rename src include 

    - name: Upload a Build Artifact
      uses: actions/upload-artifact@v2.2.4
      with:
        name: lib
        path: |
          build-Win32/Debug
          build-Win32/Release
          build-x64/Debug
          build-x64/Release
          include/*.h
