name: Build Windows Static Libraries

on: [push, pull_request]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2

    - name: Configure CMake
      run: |
        cmake src -A Win32 -B build-Win32-MD
        cmake src -A x64 -B build-x64-MD
        cmake src -A Win32 -D CMAKE_CXX_FLAGS_DEBUG=/MTd -D CMAKE_CXX_FLAGS_RELEASE=/MT -B build-Win32-MT
        cmake src -A x64 -D CMAKE_CXX_FLAGS_DEBUG=/MTd -D CMAKE_CXX_FLAGS_RELEASE=/MT -B build-x64-MT

    - name: Build
      run: |
        cmake --build build-Win32-MD --target dnslib --config Debug
        cmake --build build-Win32-MD --target dnslib --config Release
        cmake --build build-x64-MD --target dnslib --config Debug
        cmake --build build-x64-MD --target dnslib --config Release
        cmake --build build-Win32-MT --target dnslib --config Debug
        cmake --build build-Win32-MT --target dnslib --config Release
        cmake --build build-x64-MT --target dnslib --config Debug
        cmake --build build-x64-MT --target dnslib --config Release
        cmake -E make_directory lib
        cmake -E rename build-Win32-MD/Debug/dnslib.lib lib/dnslib-Win32-Debug-MDd.lib
        cmake -E rename build-Win32-MD/Release/dnslib.lib lib/dnslib-Win32-Release-MD.lib
        cmake -E rename build-x64-MD/Debug/dnslib.lib lib/dnslib-x64-Debug-MDd.lib
        cmake -E rename build-x64-MD/Release/dnslib.lib lib/dnslib-x64-Release-MD.lib
        cmake -E rename build-Win32-MT/Debug/dnslib.lib lib/dnslib-Win32-Debug-MTd.lib
        cmake -E rename build-Win32-MT/Release/dnslib.lib lib/dnslib-Win32-Release-MT.lib
        cmake -E rename build-x64-MT/Debug/dnslib.lib lib/dnslib-x64-Debug-MTd.lib
        cmake -E rename build-x64-MT/Release/dnslib.lib lib/dnslib-x64-Release-MT.lib
        cmake -E rename src include

    - name: Upload a Build Artifact
      uses: actions/upload-artifact@v2.2.4
      with:
        name: dnslib-windows-static
        path: |
          lib/*
          include/*.h
